<article class="container">
    <h1 class="pt-3 mb-4" *ngIf="!edit">
        <img src="/assets/plus-square-fill.svg" alt="icono user" class="icono">
        Creando nuevo Proveedor
    </h1>

    <h1 class="pt-3 mb-4" *ngIf="edit">
        <img src="/assets/gear-fill.svg" alt="icono user" class="icono">
        Editando Proveedor
    </h1>
    <!-- ingreso codigo de proveedor y razon social -->
    <section *ngIf="!supplierCodeValid" class="mt-3 mb-3">
        <form [formGroup]="codeForm" (ngSubmit)="submitSupplierCodeAndBusinessName()">
            <label for="codeInput" class="form-label">Raz贸n social*</label>
            <input type="text" required id="codeInput" class="form-control" formControlName="businessName"
                placeholder="Ejemplo" name="businessName" [(ngModel)]="supplier.businessName"
                oninvalid="this.setCustomValidity('El campo debe tener al menos 5 caracteres')"
                type="text"
                />
            <div *ngIf="codeForm.get('businessName')?.invalid && codeForm.get('businessName')?.touched"
                class="fw-lighter text-danger">
                La Raz贸n social debe tener entre 2 y 50 caracteres
            </div>

            <label for="codeInput" class="form-label mt-4">Codigo de proveedor*</label>
            <input type="text" required id="codeInput" class="form-control" formControlName="supplierCode"
                placeholder="Ejemplo" name="supplierCode" [(ngModel)]="supplier.supplierCode"
                oninvalid="this.setCustomValidity('El campo debe tener al menos 5 caracteres')"
                type="text"
                />
            <div *ngIf="codeForm.get('supplierCode')?.invalid && codeForm.get('supplierCode')?.touched"
                class="fw-lighter text-danger">
                El codigo de proveedor debe tener entre 4 y 50 caracteres
            </div>

            <button type="submit" [disabled]="codeForm.invalid" class="btn btn-primary mt-4">
                Continuar
            </button>
        </form>
    </section>

    <!-- rubro -->
    <section *ngIf="supplierCodeValid && !supplierCategoryValid">
        <section class="m-0 p-2 table-header bg-primary-subtle d-flex">
            <div class="col-md-9 ps-2">
              <h2 class="text-left">Seleccione un rubro</h2>
            </div>
        </section>
        
        <section style="background-color: #fff; height: 9vh;" 
        class="m-0 p-2 container-fluid filterItems border-bottom">
        <article class="row"> 
            <div class="col-md-4 d-flex justify-content-start">
                <div class="input-group input-group-append">
                    <input type="text" class="form-control" placeholder="Buscar rubro" 
                    name="category" [(ngModel)]="searchCategory" style="width: 20vw;">
                    <button class="btn btn-primary btn-icon" type="button" id="button-addon2"
                    (click)="searchByCategory()" *ngIf="!searchCategoryOn" 
                    [ngClass]="((searchCategory !== '')?'':'disabled')">
                    <i class="bi bi-search"></i>
                    </button>
                    <button class="btn btn-primary btn-icon" type="button" id="button-addon2"
                    (click)="clearSearchByCategory()" *ngIf="searchCategoryOn">
                    <i class="bi bi-x-lg"></i>
                    </button>
                </div>
            </div>     
            <nav class="col-md-8 d-flex justify-content-end filterItems pe-3" 
            aria-label="Page navigation example">
                <ul class="pagination">
                <li class="page-item" (click)="prevPage()">
                    <a class="page-link" 
                        aria-label="Previous" 
                        style="cursor: pointer;"
                        [ngClass]="(currentPage != 0)?'':'disabled'"
                    >
                    <span aria-hidden="true">Prev</span>
                    </a>
                </li>
                <li class="page-item" *ngFor="let page of getPages()">
                    <a class="page-link" 
                        [ngClass]="((currentPage+1) === page)?'active':''" 
                        style="cursor: pointer;"
                        (click)="selectPage(page-1)">{{page}}
                </a>
                </li>
                <li class="page-item" 
                (click)="nextPage()">
                    <a class="page-link" 
                    aria-label="Next"
                    style="cursor: pointer;"
                    [ngClass]="((pages !== 1) && (currentPage+1 !== pages)?'':'disabled')">
                    <span aria-hidden="true">Next</span>
                    </a>
                </li>
                </ul>
            </nav>
        
        </article>
        </section>
    
        <table class="table table-hover selectTable m-0 p-4" *ngIf="suplierCategories.length !== 0">
            <thead>
                <tr class="table">
                <th scope="col" class="columnSort" (click)="changeSort('category')">Rubro
                    <i *ngIf="categorySort === 'None'" class="bi bi-arrow-down-up"></i>
                    <i *ngIf="categorySort === 'desc'" class="bi bi-arrow-down"></i>
                    <i *ngIf="categorySort === 'asc'" class="bi bi-arrow-up"></i>
                </th>
                <th scope="col" class="columnSort" (click)="changeSort('createdAt')">Fecha de alta 
                    <i *ngIf="createdAtSort === 'None'" class="bi bi-arrow-down-up"></i>
                    <i *ngIf="createdAtSort === 'desc'" class="bi bi-arrow-down"></i>
                    <i *ngIf="createdAtSort === 'asc'" class="bi bi-arrow-up"></i>
                </th>
                </tr>
            </thead>
            <tbody>
                <!-- <tr>
                <td>{{ oldCategory }}</td>
                <td>{{ oldCreatedAt | date}}</td>
                </tr> -->
                <tr *ngFor="let suplierCategory of suplierCategories" 
                    (click)="selectSupplierCategory(suplierCategory)"
                    [ngClass]="(suplierCategory.id === supplierCategorySavedId)?'table-success':''">
                <td>{{ suplierCategory.category}}</td>
                <td>{{ suplierCategory.createdAt | date}}</td>
                
                </tr>
            </tbody>
        </table>
        <button [disabled]="!continueSupplierCategory" class="btn btn-primary mt-2" 
                (click)="continueForm()">
            Continuar
        </button>
    </section>

    <!-- condicion de iva y cuit -->
    <section *ngIf="supplierCategoryValid && !taxDadaValid">
        <form [formGroup]="taxDataForm" (ngSubmit)="submitTaxData()">
            <label for="ivaConditionInput" class="form-label mt-4">Condici贸n de IVA*</label>
            <select class="form-select" aria-label="Default select example" id="ivaConditionInput"
                class="form-control" formControlName="ivaCondition" [(ngModel)]="supplier.ivaCondition.id">
                <option value="" disabled selected>Seleccione una opci贸n</option>
                <option *ngFor="let ivaCondition of ivaConditions" [value]="ivaCondition.id">
                    {{ ivaCondition.ivaCondition }}
                </option>
              </select>

              <label for="codeInput" class="form-label mt-4">CUIT*</label>
              <input type="text" required id="codeInput" class="form-control" formControlName="cuit"
                  placeholder="Ejemplo" name="cuit" [(ngModel)]="supplier.cuit"
                  oninvalid="this.setCustomValidity('El campo debe tener 11 digitos')"
                  type="text"
                  />
                <div *ngIf="taxDataForm.get('cuit')?.invalid && taxDataForm.get('cuit')?.touched"
                    class="fw-lighter text-danger">
                    El CUIT debe tener 13 caracteres.
                </div>
                <div *ngIf="taxDataForm.get('cuit')?.invalid && taxDataForm.get('cuit')?.touched && taxDataForm.get('cuit')?.errors?.['pattern']"
                    class="fw-lighter text-danger">
                    El cuit debe tener el siguiente formato: 00-00000000-0
                </div>

                <button type="submit" [disabled]="taxDataForm.invalid" class="btn btn-primary mt-4">
                    Continuar
                </button>
        </form>
    </section>

    <!-- logo -->
    <section *ngIf="taxDadaValid && !logoValid">
        <form [formGroup]="logoForm" (ngSubmit)="submitImageUrl()">
            <label for="imageUrlInput" class="form-label mt-4">Logo*</label>
            <input type="text" required id="imageUrlInput" class="form-control" formControlName="imageUrl"
                placeholder="Ejemplo" name="imageUrl" [(ngModel)]="supplier.imageUrl"
                oninvalid="this.setCustomValidity('El campo debe tener 11 digitos')"
                type="text"
                />
            <div *ngIf="logoForm.get('imageUrl')?.invalid && logoForm.get('imageUrl')?.touched"
                class="fw-lighter text-danger">
                La URL de la imagen tener mas de 5 caracteres.
            </div>
            <div *ngIf="logoForm.get('imageUrl')?.invalid && logoForm.get('imageUrl')?.touched && logoForm.get('imageUrl')?.errors?.['pattern']"
                class="fw-lighter text-danger">
                La URL de la imagen debe terminar con .jpg o .png
            </div>

            <button type="submit" [disabled]="logoForm.invalid" class="btn btn-primary mt-4">
                Continuar
            </button>
        </form>
    </section>

    <!-- pais, provincia, ciudad, cp, calle, numero -->
    <section *ngIf="logoValid && !locationValid">
        <form [formGroup]="locationForm" (ngSubmit)="submitLocation()">
            <p>pais</p> 
            <p>provincia</p> 
            <p>ciudad</p>
            <p>cp</p>
            <p>calle</p>
            <p>numero</p>            
        </form>
    </section>

    <!-- email, telefono, pagina web -->
    <section *ngIf="locationValid && !businessInfoValid">
        <p>email, telefono, pagina web</p>
    </section>

    <!-- contactos -->
    <section *ngIf="businessInfoValid">
        <p>contacto</p>
    </section>

</article>